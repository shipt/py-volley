
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-7.3.6">
    
    
      
        <title>Volley</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="stylesheets/extra.css">
    
    
      


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL(".",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#example" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Volley" class="md-header__button md-logo" aria-label="Volley" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Volley
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Volley
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Volley" class="md-nav__button md-logo" aria-label="Volley" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Volley
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Volley
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        Volley
      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
    <nav class="md-nav" aria-label="Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-kafka-and-redis" class="md-nav__link">
    Setup Kafka and Redis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publish-some-sample-data" class="md-nav__link">
    Publish some sample data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-queues" class="md-nav__link">
    Configure queues
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#first-worker-node" class="md-nav__link">
    First worker node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#second-worker-node" class="md-nav__link">
    Second worker node
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#features" class="md-nav__link">
    Features
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    How-it-works
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="example/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Configuration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Configuration" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Configuration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="queue_config/" class="md-nav__link">
        Queues
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="profiles/" class="md-nav__link">
        Profiles
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="engine/" class="md-nav__link">
        Application
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="connectors/connectors/" class="md-nav__link">
        Consumer & Producer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="serializers/overview/" class="md-nav__link">
        Serialization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="models/overview/" class="md-nav__link">
        Model Handlers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="deadletterqueue/" class="md-nav__link">
        Dead Letter Queues
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="metrics/" class="md-nav__link">
        Metrics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="advanced_example/" class="md-nav__link">
        Advanced Example
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Extending Volley
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Extending Volley" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Extending Volley
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="extending/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_2" type="checkbox" id="__nav_6_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_2">
          Connectors
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Connectors" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Connectors
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="connectors/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="connectors/kafka/" class="md-nav__link">
        ConfluentKafka
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="connectors/rsmq/" class="md-nav__link">
        RSMQ
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" type="checkbox" id="__nav_6_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_3">
          Serializers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Serializers" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          Serializers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="serializers/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="serializers/BaseSerialization/" class="md-nav__link">
        BaseSerialization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="serializers/JsonSerialization/" class="md-nav__link">
        JsonSerialization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="serializers/MsgPackSerialization/" class="md-nav__link">
        MsgPackSerialization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="serializers/OrJsonSerialization/" class="md-nav__link">
        OrJsonSerialization
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_4" type="checkbox" id="__nav_6_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_4">
          Model Handlers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Model Handlers" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          Model Handlers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="models/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="models/BaseModelHandler/" class="md-nav__link">
        BaseModelHandler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="models/PydanticModelHandler/" class="md-nav__link">
        PydanticModelHandler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="models/PydanticParserModelHandler/" class="md-nav__link">
        PydanticParserModelHandler
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
    <nav class="md-nav" aria-label="Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-kafka-and-redis" class="md-nav__link">
    Setup Kafka and Redis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#publish-some-sample-data" class="md-nav__link">
    Publish some sample data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-queues" class="md-nav__link">
    Configure queues
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#first-worker-node" class="md-nav__link">
    First worker node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#second-worker-node" class="md-nav__link">
    Second worker node
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#features" class="md-nav__link">
    Features
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    How-it-works
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Volley</h1>
                
                <p><img alt="VolleyFull-Horizontal" src="https://user-images.githubusercontent.com/81711984/149005139-f0441dcf-c76e-4112-baf1-998d0a6abdbb.png" /></p>
<p>Volley is a lightweight and highly configurable message stream processor for Python.</p>


</a>


</a></p>
<p><strong>Repository</strong>: <a href="https://github.com/shipt/volley">https://github.com/shipt/volley</a></p>
<p>Use Volley to quickly build lightweight message queue processing microservices. Write your applications and add a few lines of code to integrate with technologies like Kafka. Volley has built in connectors for <a href="https://github.com/confluentinc/confluent-kafka-python">Confluent Kafka</a> and <a href="https://github.com/mlasevich/PyRSMQ">Redis Simple Message Queue</a>. It also provides serialization implementations in <a href="https://github.com/msgpack/msgpack-python">MessagePack</a> and <a href="https://github.com/ijl/orjson">orjson</a>, as well as data validation with <a href="https://github.com/samuelcolvin/pydantic">Pydantic</a> and <a href="https://github.com/prometheus/client_python">Prometheus</a> metrics.</p>
<h2 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h2>
<p>To demonstrate, let's create an application with two worker nodes. One consumes from Kafka, finds the maximum value in a list then publishes it to Redis. The other consumes the message from Redis - if the max value is &gt; 10, it logs to console otherwise it constructs a new list and publishes to the same Kafka topic.</p>
<p>For most simple cases, you can use a <a href="profiles/">profile</a> to define how your application should consume from or produce to a topic, as well as define handlers for serialization and data validation.</p>
<h3 id="setup-kafka-and-redis">Setup Kafka and Redis<a class="headerlink" href="#setup-kafka-and-redis" title="Permanent link">&para;</a></h3>
<p>We'll use these for our queues.</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">6379</span>:6379<span class="w"> </span>redis:5.0.0
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">9092</span>:9092<span class="w"> </span>bashj79/kafka-kraft
</code></pre></div>
<h3 id="publish-some-sample-data">Publish some sample data<a class="headerlink" href="#publish-some-sample-data" title="Permanent link">&para;</a></h3>
<p>Let's put a single message on the Kafka topic. Our sample application will process it.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">confluent_kafka</span> <span class="kn">import</span> <span class="n">Message</span><span class="p">,</span> <span class="n">Producer</span>


<span class="k">def</span> <span class="nf">acked</span><span class="p">(</span><span class="n">err</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">Message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed delivery to </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">topic</span><span class="p">()</span><span class="si">}</span><span class="s2">, message: </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="si">}</span><span class="s2">, error: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successful delivery to </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">topic</span><span class="p">()</span><span class="si">}</span><span class="s2">, partion: </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">partition</span><span class="p">()</span><span class="si">}</span><span class="s2">, offset: </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">offset</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="n">producer</span> <span class="o">=</span> <span class="n">Producer</span><span class="p">({</span><span class="s2">&quot;bootstrap.servers&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;KAFKA_BROKERS&quot;</span><span class="p">,</span> <span class="s2">&quot;localhost:9092&quot;</span><span class="p">)})</span>
<span class="n">producer</span><span class="o">.</span><span class="n">produce</span><span class="p">(</span><span class="n">topic</span><span class="o">=</span><span class="s2">&quot;my.kafka.topic.name&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;my_values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}),</span> <span class="n">callback</span><span class="o">=</span><span class="n">acked</span><span class="p">)</span>
<span class="n">producer</span><span class="o">.</span><span class="n">flush</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Published single message&quot;</span><span class="p">)</span>
</code></pre></div>
<h3 id="configure-queues">Configure queues<a class="headerlink" href="#configure-queues" title="Permanent link">&para;</a></h3>
<p>Let's put the configurations in <code>./my_config.py</code>. These configurations our worker nodes how to consume and produce to each queue. The <a href="profiles/">profile</a> provides presets for serialization and connectors and the Pydantic model handler. The <code>InputMessage</code> and <code>OutputMessage</code> will be used for validating the data we consume. The <code>confluent</code> profile uses <code>orjson</code> as the default serializer.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># my_config.py</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>


<span class="c1"># define the schemas for the first and second worker nodes.</span>
<span class="k">class</span> <span class="nc">InputMessage</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">my_values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">OutputMessage</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">the_max</span><span class="p">:</span> <span class="nb">float</span>


<span class="c1"># define the configurations for the two queues, one in Kafka and the other in Redis.</span>
<span class="n">queue_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;my-kafka-input&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;my.kafka.topic.name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;profile&quot;</span><span class="p">:</span> <span class="s2">&quot;confluent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data_model&quot;</span><span class="p">:</span> <span class="n">InputMessage</span><span class="p">,</span>
        <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;bootstrap.servers&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;KAFKA_BROKERS&quot;</span><span class="p">,</span> <span class="s2">&quot;localhost:9092&quot;</span><span class="p">),</span> <span class="s2">&quot;group.id&quot;</span><span class="p">:</span> <span class="s2">&quot;my.consumer.group&quot;</span><span class="p">},</span>
    <span class="p">},</span>
    <span class="s2">&quot;my-redis-output&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;my.redis.output.queue.name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;profile&quot;</span><span class="p">:</span> <span class="s2">&quot;rsmq&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data_model&quot;</span><span class="p">:</span> <span class="n">OutputMessage</span><span class="p">,</span>
        <span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;REDIS_HOST&quot;</span><span class="p">,</span> <span class="s2">&quot;localhost&quot;</span><span class="p">),</span>
            <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">6379</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="first-worker-node">First worker node<a class="headerlink" href="#first-worker-node" title="Permanent link">&para;</a></h3>
<p>We'll put the first worker node in app_0.py This node will consume from Kafka and produce to Redis. Configure the Engine() to point to the <code>input_queue</code> and <code>output_queues</code> specified in our <code>queue_config</code> we defined earlier.</p>
<p>The worker node is a function and it will receive a single object, which will be the message serialized and constructed into the <code>data_model</code> we specified in our <code>queue_config</code>.</p>
<p>The worker node can publish to zero or many outputs. When electing to not rely on Volley to route your message to another queue, simply return a <code>bool</code>. True will commit offsets to Kafka (or delete the message from Redis), and False will leave the message alone. Volley will produce all the messages you return to it by returning <code>List[Tuple[&lt;name_of_queue&gt;, message_object]]</code></p>
<div class="highlight"><pre><span></span><code><span class="c1"># app_0.py</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">from</span> <span class="nn">my_config</span> <span class="kn">import</span> <span class="n">InputMessage</span><span class="p">,</span> <span class="n">OutputMessage</span><span class="p">,</span> <span class="n">queue_config</span>

<span class="kn">from</span> <span class="nn">volley</span> <span class="kn">import</span> <span class="n">Engine</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="c1"># the first node - reads from kafka and writes to redis</span>
<span class="n">app_0</span> <span class="o">=</span> <span class="n">Engine</span><span class="p">(</span>
    <span class="n">app_name</span><span class="o">=</span><span class="s2">&quot;app_0&quot;</span><span class="p">,</span>
    <span class="n">input_queue</span><span class="o">=</span><span class="s2">&quot;my-kafka-input&quot;</span><span class="p">,</span>  <span class="c1"># one input</span>
    <span class="n">output_queues</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;my-redis-output&quot;</span><span class="p">],</span>  <span class="c1"># zero to many outputs</span>
    <span class="n">queue_config</span><span class="o">=</span><span class="n">queue_config</span><span class="p">,</span>
<span class="p">)</span>


<span class="nd">@app_0</span><span class="o">.</span><span class="n">stream_app</span>
<span class="k">def</span> <span class="nf">kafka_to_redis</span><span class="p">(</span><span class="n">msg</span><span class="p">:</span> <span class="n">InputMessage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">OutputMessage</span><span class="p">]]:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">max_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">my_values</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">OutputMessage</span><span class="p">(</span><span class="n">the_max</span><span class="o">=</span><span class="n">max_val</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[(</span><span class="s2">&quot;my-redis-output&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">)]</span>  <span class="c1"># a list of output targets and messages</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">kafka_to_redis</span><span class="p">()</span>
</code></pre></div>
<p>Then run the first worker</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>app_0.py
</code></pre></div>
<p>Note: Volley supports <code>asyncio</code>, just prefix your function with <code>async</code>:
<div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">stream_app</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">my_fun</span><span class="p">(</span><span class="n">msg</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</code></pre></div></p>
<h3 id="second-worker-node">Second worker node<a class="headerlink" href="#second-worker-node" title="Permanent link">&para;</a></h3>
<p>The second worker node is much like the first, except it will read from Redis and conditionally produce back to Kafka, or just create a log. We'll add some logic to make that slightly more interesting.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># app_1.py</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">my_config</span> <span class="kn">import</span> <span class="n">InputMessage</span><span class="p">,</span> <span class="n">OutputMessage</span><span class="p">,</span> <span class="n">queue_config</span>

<span class="kn">from</span> <span class="nn">volley</span> <span class="kn">import</span> <span class="n">Engine</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>


<span class="c1"># the second node</span>
<span class="n">app_1</span> <span class="o">=</span> <span class="n">Engine</span><span class="p">(</span>
    <span class="n">app_name</span><span class="o">=</span><span class="s2">&quot;app_1&quot;</span><span class="p">,</span>
    <span class="n">input_queue</span><span class="o">=</span><span class="s2">&quot;my-redis-output&quot;</span><span class="p">,</span>
    <span class="n">output_queues</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;my-kafka-input&quot;</span><span class="p">],</span>
    <span class="n">queue_config</span><span class="o">=</span><span class="n">queue_config</span><span class="p">,</span>
    <span class="n">metrics_port</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>


<span class="nd">@app_1</span><span class="o">.</span><span class="n">stream_app</span>
<span class="k">def</span> <span class="nf">redis_to_kafka</span><span class="p">(</span><span class="n">msg</span><span class="p">:</span> <span class="n">OutputMessage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InputMessage</span><span class="p">]]]:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The maximum: </span><span class="si">{</span><span class="n">msg</span><span class="o">.</span><span class="n">the_max</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">the_max</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;That&#39;s it, we are done!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">InputMessage</span><span class="p">(</span><span class="n">my_values</span><span class="o">=</span><span class="p">[</span><span class="n">msg</span><span class="o">.</span><span class="n">the_max</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">the_max</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">msg</span><span class="o">.</span><span class="n">the_max</span> <span class="o">+</span> <span class="mi">2</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">[(</span><span class="s2">&quot;my-kafka-input&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">)]</span>  <span class="c1"># a list of one or many output targets and messages</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">redis_to_kafka</span><span class="p">()</span>
</code></pre></div>
<p>Then run the second worker node.</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>app_1.py
</code></pre></div>
<p>You should see the following in your two terminals</p>
<p><strong>./app_0.py</strong>
<div class="highlight"><pre><span></span><code>Received {&quot;my_values&quot;: [1.0, 2.0, 3.0]}
the_max=3.0
Received {&quot;my_values&quot;: [3.0, 4.0, 5.0]}
the_max=5.0
Received {&quot;my_values&quot;: [5.0, 6.0, 7.0]}
the_max=7.0
Received {&quot;my_values&quot;: [7.0, 8.0, 9.0]}
the_max=9.0
Received {&quot;my_values&quot;: [9.0, 10.0, 11.0]}
the_max=11.0
</code></pre></div></p>
<p><strong>./app_1.py</strong>
<div class="highlight"><pre><span></span><code>The maximum: 3.0
The maximum: 5.0
The maximum: 7.0
The maximum: 9.0
The maximum: 11.0
That&#39;s it, we are done!
</code></pre></div></p>
<p>See our <a href="example/">example</a> for a more in-depth example.</p>
<h2 id="features">Features<a class="headerlink" href="#features" title="Permanent link">&para;</a></h2>
<p>Volley is production-ready, and provides the following to all functions that it wraps:</p>
<ul>
<li>Prometheus <a href="metrics/">Metrics</a> for system observability</li>
<li>Data validation via <a href="https://pydantic-docs.helpmanual.io/">Pydantic</a></li>
<li>Built-in support for both Kafka and <a href="https://github.com/mlasevich/PyRSMQ">pyRSMQ</a>(Redis)</li>
<li>Serialization in JSON and <a href="https://msgpack.org/index.html">MessagePack</a></li>
<li>Extensible data validation and schemas, data store connectors, and serialization with plugins</li>
<li>Optional <a href="deadletterqueue/">dead-letter-queues</a> for serialization and schema validation failures</li>
</ul>
<h2 id="how-it-works">How-it-works<a class="headerlink" href="#how-it-works" title="Permanent link">&para;</a></h2>
<p>Volley handles operations that need to happen before and after the processing in your function:</p>
<ul>
<li>
<p>poll the specified <code>input_queue</code> for new messages via a <code>connector</code></p>
</li>
<li>
<p>the <code>connector</code> passes message through <code>serialization</code></p>
</li>
<li>
<p><code>serialization</code> passes the message through a user provided <code>data_model</code> for schema validation</p>
</li>
<li>
<p>message is passed to your function, and your function messages returns zero to many messages back to Volley</p>
</li>
<li>
<p>message passes through schema validation specified for the <code>output_queue</code></p>
</li>
<li>
<p>message is serialized for <code>output_queue</code></p>
</li>
<li>
<p><code>connector</code> publishes message to <code>output_queue</code></p>
</li>
</ul>
<p>Messages that fail either <code>serialization</code> or <code>validation</code> are routed to a <a href="deadletterqueue/">dead-letter-queue</a>, if specified. Users can also route messages to a dead-letter-queue the same as any other output queue.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
      
        
        <a href="example/" class="md-footer__link md-footer__link--next" aria-label="Next: Getting Started" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Getting Started
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.fcfe8b6d.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.b1047164.min.js"></script>
      
    
  </body>
</html>