language: python
team: machine-learning
metadata:
  description: The bundle engine consists of workers + queues to process incoming bundle requests from Kafka and optimize
deploy:
  pipeline: harbor
  chart: default
  group: ds
  environments:
  - name: production
    releaseStrategy:
      branch: main
      tagFormat: semver
  - name: staging
    releaseStrategy:
      branch: main
  deployLocations:
  - provider: gcp
    region: us-central1
roles:
  worker:
    - name: process-fifo1-queue
      command: rq worker --url=$ML_BUNDLE_QUEUE_URL fifo-1
      replicaCount: 1
    - name: make-predictions-fifo-2
      command: rq worker --url=$ML_BUNDLE_QUEUE_URL fifo-2
      replicaCount: 1
    - name: triage-optimizations
      command: rq worker --url=$ML_BUNDLE_QUEUE_URL fifo-3
      replicaCount: 1
datastores:
  memoryStore:
    - name: redis-queue
      configVar: ML_BUNDLE_QUEUE_URL
      size: 1
