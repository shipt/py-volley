language: python
team: machine-learning
metadata:
  description: The bundle engine consists of workers + queues to process incoming bundle requests from Kafka and optimize
deploy:
  pipeline: harbor
  chart: default
  group: ds
  environments:
  - name: production
    releaseStrategy:
      branch: main
      tagFormat: semver
  - name: staging
    releaseStrategy:
      branch: main
  deployLocations:
  - provider: gcp
    region: us-central1
roles:
  worker:
    - name: features
      command: python main.py features
      replicaCount: 1
      environment:
      - INPUT_QUEUE=input_kafka_topic_name
      - OUTPUT_QUEUE=triage
    - name: triage
      command: python main.py triage
      replicaCount: 1
      environment:
      - INPUT_QUEUE=triage
      - OUTPUT_QUEUE=collector
    - name: collector
      command: python main.py collector
      replicaCount: 1
      environment:
      - INPUT_QUEUE=collector
      - OUTPUT_QUEUE=output_kafka_topic_name
datastores:
  memoryStore:
    - name: redis-queue
      configVar: REDIS_HOST
      size: 1
